#!/usr/bin/env zsh
# Status script for dwm

# The MIT License (MIT) http://opensource.org/licenses/MIT


music(){
  track="$(mpc current)"
  artist="${track%%- *}"
  title="${track#*- }"
  [[ -n $artist ]] && printf "%b" "• $artist - $title "
}

vol(){
  vol="$(pactl list sinks | grep 'Volume' |awk 'FNR == 3 {print $5}')"
  printf "%b" "$vol"
}

bat(){
  onl="$(</sys/class/power_supply/AC/online)"
  charge="$(</sys/class/power_supply/BAT0/capacity)"
  if [[ $onl -eq 0 && $charge -ge 15 ]]; then
    printf "%b" "BAT \x04$charge%\x01"
  elif [[ $onl -eq 0 && $charge -le 14 ]]; then
    printf "%b" "BAT $charge%"
  else
    printf "%b" "AC $charge%"
  fi
}

mem(){
  mem="$(awk '/^Mem/ {print $3}' <(free -m))"
  printf "%b" "$mem"
}

cpu(){
  ~/src/scripts/cpu.py
}

hdd(){
  ~/src/scripts/hdd.py
}

eml(){
  maildirs="imaps://imap.gmail.com:993"
  ml="$(find $maildirs -type f | wc -l)"
  if (( ml > 0 )); then
    printf "%b" "\x03$ml\x01"
  else
    printf "0"
  fi
}

dte(){
  dte="$(date "+%T_%m-%d")"
  printf "%b" "$dte"
}

# Pipe to status bar
#xsetroot -name "$(music) • CPU $(cpu) • MEM $(mem) • HDD $(hdd)\
#• NET $(int) • $(dte) • VOL $(vol) "
xsetroot -name "$(music) • cpu $(cpu)% • $(hdd) • $(dte) • vol $(vol) "
